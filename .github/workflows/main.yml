name: JSON scheduled update

on:
  schedule:
  - cron: '0 0 * * 0'
  workflow_dispatch:

jobs:
  update:
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false
    steps:
      - name: Checkout
        uses: actions/checkout@v2
      - name: update JSON file
      
        run: |
          cd src/assets
          curl https://raw.githubusercontent.com/Mimori256/kdb-parse/main/kdb_twinc.json > kdb.json
          cd ..
          cd ..
      - name: Build
        run: |
          npm ci
          npm run deploy
        env: 
          CI: false
      - name: Push and Commit
        run: |
          git add .
          if git diff --exit-code --quiet
          then
            git config --global user.email "mimorimori256@gmail.com"
            git config --global user.name "Mimori256"
            git commit -m "update JSON: $(date +%Y%m%d)"
            git push -f origin main
          fi
